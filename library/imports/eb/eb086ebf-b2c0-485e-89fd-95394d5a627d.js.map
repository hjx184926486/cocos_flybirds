{"version":3,"sources":["../../../../assets/Script/assets/Script/SubDomController.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"../../../../assets/Script","sourcesContent":["const {ccclass, property} = cc._decorator;\n\nconst wx = window[\"wx\"];\nconst sharedCanvas = window[\"sharedCanvas\"]\n/**\n * 子域控制器\n */\n\n \n@ccclass\nexport  class SubDomController extends cc.Component {\n    \n    start(){\n\n\n    }\n    update(){\n        SubDomController.display();\n    }\n    public static KEYS = [];\n\n    public static OBJ:object = {};\n\n    /**\n     * 帧循环刷新域\n     */\n    public static display():void{\n        if(cc.sys.platform !== cc.sys.WECHAT_GAME){return;}\n\n        let del:Array<string> = new Array();\n\n        SubDomController.KEYS.forEach((value, index) => {\n            if(wx.getOpenDataContext().canvas[value]){\n                console.log(\"主域收到回复:\",value,wx.getOpenDataContext().canvas[value])\n                let feedback = SubDomController.OBJ[value];\n                if(typeof feedback == \"function\")\n                feedback(wx.getOpenDataContext().canvas[value])\n                del.push(value)\n            }\n        });\n\n        del.forEach((value, index) => {\n            SubDomController.deleteArr(SubDomController.KEYS,value);\n            SubDomController.OBJ[value] = undefined;\n            wx.postMessage({message: {type:1,key:value,msg:\"清除一个对象\"}})\n        });\n      \n    }\n\n    /**\n     * 获取用户信息\n     */\n    public static getUserInfo(feedback){\n        if(cc.sys.platform !== cc.sys.WECHAT_GAME){\n            if(typeof feedback == \"function\")\n            feedback({\"openId\":\"selfOpenId\",\"nickname\":\"安康\",\"avatarUrl\":\"https://wx.qlogo.cn/mmopen/vi_32/ajNVdqHZLLB0tbB2zibOjGicv7ztvR2Z1jMvBOuDSnFUF1UWZNwiaibH4ibLIws61ePicATFTeDic6wkr3x5UXxKP4E4g/132\",\"gender\":1,\"language\":\"zh_CN\",\"city\":\"\",\"province\":\"\",\"country\":\"中国\"});\n            return ;\n        }\n        SubDomController.OBJ['USER_INFO'] = feedback;\n        SubDomController.KEYS.push(\"USER_INFO\");\n        wx.postMessage({message: {type:3,key:\"USER_INFO\",msg:\"获取用户信息\"}})\n    }\n\n    /**\n     * 获取好友信息\n     * @param feedback \n     */\n    public static getFriendInfo(feedback){\n        // SubDomController.OBJ['FRIEND_STORAGE'] = feedback;\n        if(cc.sys.platform !== cc.sys.WECHAT_GAME){\n            let res = [{\n                    \"openid\": \"oIBzT5Ipt2UG9_qmqBChfElWFhyU\",\n                    \"nickname\": \"Momo\",\n                    \"avatarUrl\": \"https://wx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoBDWashnx1icbCrez0bWOm2rjpCQ0Pa84yITGOefKWv6Nqlt4yxZ7hz2gmrlWLb2zG0lH9maWVUicg/132\",\n                    \"KVDataList\": [{\n                        \"key\": \"score\",\n                        \"value\": \"7777\"\n                    }]\n                },{\n                    \"openid\": \"1\",\n                    \"nickname\": \"安康2\",\n                    \"avatarUrl\": \"https://wx.qlogo.cn/mmopen/vi_32/ajNVdqHZLLB0tbB2zibOjGicv7ztvR2Z1jMvBOuDSnFUF1UWZNwiaibH4ibLIws61ePicATFTeDic6wkr3x5UXxKP4E4g/132\",\n                    \"KVDataList\": [{\n                        \"key\": \"score\",\n                        \"value\": \"8888\"\n                    }]\n                },{\n                    \"openid\": \"2\",\n                    \"nickname\": \"安康3\",\n                    \"avatarUrl\": \"https://wx.qlogo.cn/mmopen/vi_32/ajNVdqHZLLB0tbB2zibOjGicv7ztvR2Z1jMvBOuDSnFUF1UWZNwiaibH4ibLIws61ePicATFTeDic6wkr3x5UXxKP4E4g/132\",\n                    \"KVDataList\": [{\n                        \"key\": \"score\",\n                        \"value\": \"9999\"\n                    }]\n                },{\n                    \"openid\": \"oIBzT5BFyVZeFtpA76bycj4as7KQ\",\n                    \"nickname\": \"安康5\",\n                    \"avatarUrl\": \"https://wx.qlogo.cn/mmopen/vi_32/ajNVdqHZLLB0tbB2zibOjGicv7ztvR2Z1jMvBOuDSnFUF1UWZNwiaibH4ibLIws61ePicATFTeDic6wkr3x5UXxKP4E4g/132\",\n                    \"KVDataList\": [{\n                        \"key\": \"score\",\n                        \"value\": \"0\"\n                    }]\n                }\n            ];\n            if(typeof feedback == \"function\")\n            feedback(res);\n            return;\n        }\n        SubDomController.OBJ['FRIEND_STORAGE'] = feedback;\n        SubDomController.KEYS.push(\"FRIEND_STORAGE\");\n        wx.postMessage({message: {type:2,key:\"score\",msg:\"获取好友信息\"}})\n    }\n    /**\n     * 获取用户分数\n     */\n    public static getUserScore(feedback){\n        if(cc.sys.platform !== cc.sys.WECHAT_GAME){\n            if(typeof feedback == \"function\"){\n                feedback(\n                    [{\n                        \"key\": \"score\",\n                        \"value\": \"10\"\n                    }\n                 ]);\n                return;\n            }\n        }\n        \n        SubDomController.OBJ['USER_STORAGE'] = feedback;\n        SubDomController.KEYS.push(\"USER_STORAGE\");\n        wx.postMessage({message: {type:1,key:\"USER_STORAGE\",msg:\"获取用户分数\"}})\n    }\n    /**删除数组中的一个指定值 */\n    private static deleteArr(arr:Array<string>,key:string){\n        arr.forEach((value, index) => {\n            if (value == key) {\n                arr.splice(index, 1);\n                return ;\n            }\n        });\n    }\n\n}\n"]}